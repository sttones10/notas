<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fatura de Locação – Transelian</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --ink:#1f2937; }
    body { background:#f1f5f9; color:#111; }
    .box { border:1.5px solid var(--ink); }
    .title { background:#e5e7eb; font-weight:600; padding:6px 10px; border-top:1.5px solid var(--ink); border-bottom:1.5px solid var(--ink); }
    table.invoice { width:100%; border-collapse:collapse; }
    table.invoice th, table.invoice td{ border-left:1px solid var(--ink); border-right:1px solid var(--ink); }
    table.invoice thead tr{ border-top:1.5px solid var(--ink); border-bottom:1.5px solid var(--ink); }
    table.invoice tfoot tr{ border-top:1.5px solid var(--ink); }
    .kv label{ font-size:11px; color:#374151; display:block; }
    .kv input, .kv textarea, .kv select{ width:100%; border:1px solid #cbd5e1; border-radius:6px; padding:6px 8px; }
    .kv .ro{ background:#f8fafc; }
    @media print {
      .no-print { display:none!important; }
      body { background:white; }
      .shadow-xl{ box-shadow:none; }
      a[href]:after { content: none !important; }
    }
  </style>
</head>
<body class="max-w-4xl mx-auto p-4 text-slate-800">
  <header class="no-print flex items-center justify-between mb-3">
    <div class="flex items-center gap-2">
      <select id="clientSelect" class="border rounded px-2 py-2 text-sm min-w-[240px]"></select>
      <button id="btnAddClient" class="px-3 py-2 rounded bg-indigo-600 text-white">+ Cliente</button>
      <button id="btnExportClients" class="px-3 py-2 rounded border">Exportar</button>
      <input id="importClientsFile" type="file" accept="application/json" class="hidden" />
      <button id="btnImportClients" class="px-3 py-2 rounded border">Importar</button>
    </div>
    <div class="flex gap-2">
      <button id="btnSaveCurrent" class="px-3 py-2 rounded border">Salvar rascunho</button>
      <button id="btnLoadCurrent" class="px-3 py-2 rounded border">Carregar</button>
      <button id="btnPrint" class="px-3 py-2 rounded bg-emerald-600 text-white">Imprimir / PDF</button>
    </div>
  </header>

  <div id="app" class="bg-white shadow-xl rounded-xl overflow-hidden box">
    <!-- TOPO -->
    <section class="grid grid-cols-12">
      <!-- Logo + empresa -->
      <div class="col-span-9 p-1 flex gap-2 items-start">
        <div class="flex flex-col items-start gap-1">
          <img id="logoPreview" class="w-20 h-6 object-contain" alt="Logo" src="https://sttones10.github.io/notas/logo%20transelian.png"/>
        </div>
        <div class="text-center w-full">
          <div class="text-[14px] font-bold">TRANSELIAN TRANSPORTES LTDA - ME</div>
          <div class="text-[11px] leading-tight">
            <div>RUA DA VILLARES, N° 248, B. SIDERURGIA – OURO BRANCO – MINAS GERAIS</div>
            <div>CEP: 36420-000 &nbsp; CNPJ: <span id="issuerDocView">07.958.145/0001-49</span> &nbsp; CONTATO: <span id="issuerContactView">(31) 9 96331518 - ALMIR</span></div>
          </div>
        </div>
      </div>
      <!-- Quadro Fatura -->
      <div class="col-span-3 p-1 box border-l-0">
        <div class="text-center text-[12px] font-semibold">FATURA<br>DE LOCAÇÃO</div>
        <div class="mt-2 text-center">
          <div class="text-[11px]">N°</div>
          <div class="text-lg font-bold" id="invNumberView">299</div>
          <div class="mt-1 text-[11px]">DATA:</div>
          <div class="text-[12px] font-semibold" id="invDateView">30/08/2025</div>
          <div class="no-print mt-1 text-[10px] flex flex-col gap-1">
            <input id="invNumber" class="border rounded p-1 text-xs" placeholder="Número"/>
            <input id="invDate" type="date" class="border rounded p-1 text-xs"/>
          </div>
        </div>
      </div>
    </section>

    <!-- DEST/CONTRATO/PAG/OBS -->
    <section class="grid grid-cols-12">
      <div class="col-span-12 box border-l-0 border-r-0">
        <div class="title">DESTINATÁRIO</div>
        <div class="p-3 grid grid-cols-12 gap-3 kv text-[12px]">
          <div class="col-span-6"><label>Razão Social</label><input id="clientName"/></div>
          <div class="col-span-3"><label>CNPJ / CPF</label><input id="clientDoc"/></div>
          <div class="col-span-2"><label>CEP</label><input id="clientCEP"/></div>
          <div class="col-span-1"><label>UF</label><input id="clientUF"/></div>
          <div class="col-span-8"><label>Endereço</label><input id="clientAddr"/></div>
          <div class="col-span-3"><label>Cidade</label><input id="clientCity"/></div>
          <div class="col-span-1"><label>Inscr. Est.</label><input id="clientIE"/></div>
        </div>
      </div>

      <div class="col-span-12 box border-l-0 border-r-0">
        <div class="title grid grid-cols-2"><span>CONTRATO</span><span class="text-right pr-2">PAGAMENTO</span></div>
        <div class="p-3 grid grid-cols-12 gap-3 kv text-[12px]">
          <div class="col-span-3"><label>Contrato</label><input id="contractNum"/></div>
          <div class="col-span-3"><label>PC</label><input id="pcNum"/></div>
          <div class="col-span-3"><label>Valor Mensal</label><input id="monthlyValue" type="number" step="0.01"/></div>
          <div class="col-span-3"><label>Vencimento</label><input id="dueDate" type="date"/></div>
          <div class="col-span-3"><label>Forma</label><input id="paymentTerms" value="DEPÓSITO BANCÁRIO"/></div>
          <div class="col-span-9"><label>Dados Bancários</label>
            <textarea id="bankData" rows="3">BANCO DO BRASIL
AGÊNCIA: 2372-8
CONTA CORRENTE: 20567-2
TRANSELIAN TRANSPORTES LTDA</textarea>
          </div>
        </div>
      </div>

      <div class="col-span-12 box border-l-0 border-r-0">
        <div class="title">OBSERVAÇÃO</div>
        <div class="p-3 kv text-[12px]">
          <textarea id="notes" rows="3">DESCONTO COMPRA DE 4 PNEUS (EDIM) SEGUNDA PARCELA : R$ 4.200,00</textarea>
        </div>
      </div>
    </section>

    <!-- DADOS DA LOCAÇÃO -->
    <section>
      <div class="title">DADOS DA LOCAÇÃO</div>
      <div class="no-print p-3 flex items-center gap-2">
        <button id="btnAddItem" class="px-3 py-2 rounded border">Adicionar item</button>
      </div>
      <div class="overflow-x-auto">
        <table class="invoice text-[12px]">
          <thead class="bg-gray-100">
            <tr>
              <th class="text-left p-2 w-24">Código</th>
              <th class="text-left p-2">Descrição / Quantidade</th>
              <th class="text-right p-2 w-32">Valor Unitário</th>
              <th class="text-right p-2 w-32">Valor Total</th>
              <th class="no-print w-24"></th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
          <tfoot>
            <tr>
              <td class="p-2" colspan="2"></td>
              <td class="p-2 text-right font-semibold">Valor Total da Fatura:</td>
              <td class="p-2 text-right font-bold text-[14px]" id="totalView">R$ 0,00</td>
              <td class="no-print"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </section>

    <!-- RECIBO -->
    <section class="grid grid-cols-12">
      <div class="col-span-12 box border-l-0 border-r-0">
        <div class="p-3 text-[11px]">
          RECEBI(EMOS) DE <span class="font-semibold">EMPRESA</span>, AS LOCAÇÕES CONSTANTES NESSA FATURA INDICADA AO LADO.
        </div>
      </div>
      <div class="col-span-6 box border-l-0 border-r-0">
        <div class="p-3 grid grid-cols-12 text-[12px] gap-2">
          <div class="col-span-6">DATA DO RECEBIMENTO</div>
          <div class="col-span-6">IDENTIFICAÇÃO E ASSINATURA DO RECEBEDOR</div>
        </div>
      </div>
      <div class="col-span-6 box border-l-0 border-r-0">
        <div class="p-3 text-right text-[13px]">N°: <span id="invNumberView2">299</span></div>
      </div>
    </section>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const el=(t,c)=>{const e=document.createElement(t); if(c) e.className=c; return e;};
    const fmt=(v)=> new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v||0);
    const store={set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)),get:(k,d=null)=>{try{return JSON.parse(localStorage.getItem(k))??d;}catch{return d;}},del:(k)=>localStorage.removeItem(k)};

    const inputs={
      clientName: $('#clientName'), clientDoc: $('#clientDoc'), clientCEP: $('#clientCEP'), clientUF: $('#clientUF'), clientAddr: $('#clientAddr'), clientCity: $('#clientCity'), clientIE: $('#clientIE'),
      contractNum: $('#contractNum'), pcNum: $('#pcNum'), monthlyValue: $('#monthlyValue'), dueDate: $('#dueDate'),
      paymentTerms: $('#paymentTerms'), bankData: $('#bankData'), notes: $('#notes'),
      invNumber: $('#invNumber'), invDate: $('#invDate')
    };

    const clientSelect=$('#clientSelect');
    let clients=store.get('fatura_clients',[]);

    function renderClients(){
      clientSelect.innerHTML='<option value="">— selecionar —</option>';
      clients.forEach(c=>{const o=document.createElement('option');o.value=c.id;o.textContent=c.name;clientSelect.appendChild(o);});
    }
    function saveClient(c){
      const idx=clients.findIndex(x=>x.id===c.id);
      if(idx>=0) clients[idx]=c; else clients.push(c);
      store.set('fatura_clients',clients);
      renderClients();
    }
    function fillClient(c){
      inputs.clientName.value=c.name||'';
      inputs.clientDoc.value=c.doc||'';
      inputs.clientCEP.value=c.cep||'';
      inputs.clientUF.value=c.uf||'';
      inputs.clientAddr.value=c.addr||'';
      inputs.clientCity.value=c.city||'';
      inputs.clientIE.value=c.ie||'';
      persistAll();
    }

    // cliente novo (prompt simples)
    $('#btnAddClient').addEventListener('click',()=>{
      const name=prompt('Razão Social:'); if(!name) return;
      const doc=prompt('CNPJ/CPF:');
      const addr=prompt('Endereço:');
      const city=prompt('Cidade:');
      const uf=prompt('UF:');
      const cep=prompt('CEP:');
      const ie=prompt('Inscrição Estadual:');
      const c={id:crypto.randomUUID(),name,doc,addr,city,uf,cep,ie};
      saveClient(c);
      clientSelect.value=c.id; fillClient(c);
    });
    clientSelect.addEventListener('change',()=>{ const c=clients.find(x=>x.id===clientSelect.value); if(c) fillClient(c); });

    // Itens
    const itemsBody=$('#itemsBody');
    function addItemRow(item={code:'',desc:'',qty:1,unit:0}){
      const tr=el('tr');
      const tdCode=el('td','p-2 align-top');
      const tdDesc=el('td','p-2 align-top');
      const tdUnit=el('td','p-2 text-right align-top');
      const tdTot=el('td','p-2 text-right align-top');
      const tdDel=el('td','p-2 no-print');

      const iCode=el('input','w-full border rounded px-2 py-1 text-[12px]'); iCode.value=item.code||'';
      const iDesc=el('textarea','w-full border rounded px-2 py-1 text-[12px]'); iDesc.rows=3; iDesc.value=item.desc||'';
      const iUnit=el('input','w-full border rounded px-2 py-1 text-right text-[12px]'); iUnit.type='number'; iUnit.step='0.01'; iUnit.value=item.unit||0;
      const tot=el('div','text-[12px]');
      const btn=el('button','px-2 py-1 border rounded'); btn.textContent='Remover';

      tdCode.appendChild(iCode); tdDesc.appendChild(iDesc); tdUnit.appendChild(iUnit); tdTot.appendChild(tot); tdDel.appendChild(btn);
      tr.append(tdCode,tdDesc,tdUnit,tdTot,tdDel); itemsBody.appendChild(tr);

      function recalc(){ tot.textContent=fmt(parseFloat(iUnit.value||0)*(parseFloat(1))); persistAll(); updateTotals(); }
      [iCode,iDesc].forEach(x=>x.addEventListener('input',()=>{persistAll();}));
      iUnit.addEventListener('input',recalc);
      btn.addEventListener('click',()=>{ tr.remove(); persistAll(); updateTotals(); });
      recalc();
    }

    function captureItems(){
      return [...itemsBody.querySelectorAll('tr')].map(r=>{
        const [code,desc,unit]=r.querySelectorAll('input, textarea');
        return {code:code.value, desc:desc.value, qty:1, unit:parseFloat(unit.value)||0};
      });
    }
    function updateTotals(){
      const total=captureItems().reduce((a,it)=>a+(it.unit*(it.qty||1)),0);
      $('#totalView').textContent=fmt(total);
    }

    $('#btnAddItem').addEventListener('click',()=>addItemRow());

    // persistência
    function capture(){
      return {
        invNumber: $('#invNumberView').textContent,
        invDate: $('#invDateView').textContent.split('/').reverse().join('-'),
        clientName: inputs.clientName.value, clientDoc: inputs.clientDoc.value, clientCEP: inputs.clientCEP.value, clientUF: inputs.clientUF.value, clientAddr: inputs.clientAddr.value, clientCity: inputs.clientCity.value, clientIE: inputs.clientIE.value,
        contractNum: inputs.contractNum.value, pcNum: inputs.pcNum.value, monthlyValue: parseFloat(inputs.monthlyValue.value)||0, dueDate: inputs.dueDate.value,
        paymentTerms: inputs.paymentTerms.value, bankData: inputs.bankData.value, notes: inputs.notes.value,
        items: captureItems()
      };
    }
    function apply(d){
      $('#invNumberView').textContent = d.invNumber || '000';
      $('#invNumberView2').textContent = d.invNumber || '000';
      $('#invDateView').textContent = (d.invDate||'').split('-').reverse().join('/') || '';
      for(const k of Object.keys(inputs)){ if(inputs[k]) inputs[k].value = d[k] ?? inputs[k].value; }
      itemsBody.innerHTML=''; (d.items||[]).forEach(addItemRow); updateTotals();
    }
    function persistAll(){ store.set('fatura_current', capture()); }

    // refletir inputs de número/data no cabeçalho
    inputs.invNumber?.addEventListener('input',()=>{ $('#invNumberView').textContent = inputs.invNumber.value || '000'; $('#invNumberView2').textContent = inputs.invNumber.value || '000'; persistAll(); });
    inputs.invDate?.addEventListener('change',()=>{ const d=inputs.invDate.value; $('#invDateView').textContent = d? d.split('-').reverse().join('/') : '__/__/____'; persistAll(); });

    // export/import clientes
    $('#btnExportClients').addEventListener('click',()=>{ const data=JSON.stringify(clients,null,2); const blob=new Blob([data],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='clientes.json'; a.click(); URL.revokeObjectURL(url); });
    const importClientsFile=$('#importClientsFile');
    $('#btnImportClients').addEventListener('click',()=>importClientsFile.click());
    importClientsFile.addEventListener('change',(e)=>{ const f=e.target.files?.[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ clients=JSON.parse(r.result)||[]; store.set('fatura_clients',clients); renderClients(); alert('Clientes importados.'); }catch{ alert('Arquivo inválido.'); } }; r.readAsText(f); });

    // rascunho + impressão
    $('#btnSaveCurrent').addEventListener('click',()=>{ persistAll(); alert('Rascunho salvo.'); });
    $('#btnLoadCurrent').addEventListener('click',()=>{ const d=store.get('fatura_current'); if(d) apply(d); else alert('Nenhum rascunho.'); });
    $('#btnPrint').addEventListener('click',()=>window.print());

    // init
    (function(){
      renderClients();
      const d=store.get('fatura_current');
      if(d){ apply(d); }
      else{
        // dados iniciais de exemplo
        apply({
          invNumber:'299', invDate:'2025-08-30',
          clientName:'PRUMO ENGENHARIA EIRELI', clientDoc:'20.651.311/0001-28', clientCEP:'35570009', clientUF:'MG', clientAddr:'PÁTIO DA ESTAÇÃO FERROVIÁRIA, 15 – CENTRO', clientCity:'FORMIGA', clientIE:'2.612.401.260.076',
          contractNum:'3531/2022', pcNum:'447377', monthlyValue:18000, dueDate:'2025-10-07',
          paymentTerms:'DEPÓSITO BANCÁRIO', bankData:`BANCO DO BRASIL\nAGÊNCIA: 2372-8\nCONTA CORRENTE: 20567-2\nTRANSELIAN TRANSPORTES LTDA`,
          notes:'DESCONTO COMPRA DE 4 PNEUS (EDIM) SEGUNDA PARCELA : R$ 4.200,00',
          items:[{code:'',desc:`LOCAÇÃO DE CAMINHÃO MUNCK, SEM MOTORISTA.\nPLACA DO CAMINHÃO : RUB1A61\nPERÍODO: 26/07/2025 a 25/08/2025\nVENCIMENTO: 07/10/2025`, qty:1, unit:13800.00}]
        });
      }
    })();
  </script>
</body>
</html>


