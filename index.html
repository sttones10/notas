<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fatura de Locação – Transelian</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --ink:#1f2937; }
    body { background:#f1f5f9; color:#111; }
    .box { border:1.5px solid var(--ink); border-radius:10px; }
    .title { background:#e5e7eb; font-weight:600; padding:6px 10px; border-top:1.5px solid var(--ink); border-bottom:1.5px solid var(--ink); }
    table.invoice { width:100%; border-collapse:collapse; }
    table.invoice th, table.invoice td{ border-left:1px solid var(--ink); border-right:1px solid var(--ink); }
    table.invoice thead tr{ border-top:1.5px solid var(--ink); border-bottom:1.5px solid var(--ink); }
    table.invoice tfoot tr{ border-top:1.5px solid var(--ink); }
    .kv label{ font-size:11px; color:#374151; display:block; }
    .kv input, .kv textarea, .kv select{ width:100%; border:1px solid #cbd5e1; border-radius:8px; padding:6px 8px; font-size:12px; background:#fff; }
    .kv .ro{ background:#f8fafc; }
    @media print {
      .no-print { display:none!important; }
      body { background:white; margin:0; }
      .shadow-xl{ box-shadow:none; }
      a[href]:after { content: none !important; }
      @page { margin: 10mm; }
      header, footer { display: none !important; }
    }
  </style>
</head>
<body class="max-w-4xl mx-auto p-4 text-slate-800">
  <header class="no-print flex items-center justify-between mb-3">
    <div class="flex items-center gap-2">
      <select id="clientSelect" class="border rounded px-2 py-2 text-sm min-w-[240px]"></select>
      <button id="btnAddClient" class="px-3 py-2 rounded bg-indigo-600 text-white">+ Cliente</button>
      <button id="btnManageClients" class="px-3 py-2 rounded border">Gerenciar</button>
      <button id="btnExportClients" class="px-3 py-2 rounded border">Exportar</button>
      <input id="importClientsFile" type="file" accept="application/json" class="hidden" />
      <button id="btnImportClients" class="px-3 py-2 rounded border">Importar</button>
    </div>
    <div class="flex gap-2">
      <button id="btnSaveCurrent" class="px-3 py-2 rounded border">Salvar rascunho</button>
      <button id="btnLoadCurrent" class="px-3 py-2 rounded border">Carregar</button>
      <button id="btnExportPDF" class="px-3 py-2 rounded bg-emerald-600 text-white">Exportar PDF</button>
    </div>
  </header>

  <div id="app" class="bg-white shadow-xl rounded-xl overflow-hidden box">
    <!-- TOPO -->
    <section class="grid grid-cols-12 items-center">
      <!-- Logo + empresa -->
      <div class="col-span-9 p-1 flex gap-2 items-center">
        <img id="logoPreview" class="w-32 h-12 object-contain" alt="Logo" src="https://sttones10.github.io/notas/logo%20transelian.png"/>
        <div class="text-center w-full">
          <div class="text-[14px] font-bold">TRANSELIAN TRANSPORTES LTDA - ME</div>
          <div class="text-[11px] leading-tight">
            <div>RUA DA VILLARES, N° 248, B. SIDERURGIA – OURO BRANCO – MINAS GERAIS</div>
            <div>CEP: 36420-000 &nbsp; CNPJ: <span id="issuerDocView">07.958.145/0001-49</span> &nbsp; CONTATO: <span id="issuerContactView">(31) 9 96331518 - ALMIR</span></div>
          </div>
        </div>
      </div>
      <!-- Quadro Fatura -->
      <div class="col-span-3 p-1 box border-l-0">
        <div class="text-center text-[12px] font-semibold">FATURA<br>DE LOCAÇÃO</div>
        <div class="mt-2 text-center">
          <div class="text-[11px]">N°</div>
          <div class="text-lg font-bold" id="invNumberView">299</div>
          <div class="mt-1 text-[11px]">DATA:</div>
          <div class="text-[12px] font-semibold" id="invDateView">30/08/2025</div>
          <div class="no-print mt-1 text-[10px] flex flex-col gap-1">
            <input id="invNumber" class="border rounded p-1 text-xs" placeholder="Número"/>
            <input id="invDate" type="date" class="border rounded p-1 text-xs"/>
          </div>
        </div>
      </div>
    </section>

    <!-- DESTINATÁRIO -->
    <section class="grid grid-cols-12">
      <div class="col-span-12 box border-l-0 border-r-0">
        <div class="title">DESTINATÁRIO</div>
        <div class="p-2 grid grid-cols-12 gap-2 kv text-[11px]">
          <div class="col-span-6"><label>Razão Social</label><input id="clientName"/></div>
          <div class="col-span-3"><label>CNPJ / CPF</label><input id="clientDoc"/></div>
          <div class="col-span-2"><label>CEP</label><input id="clientCEP"/></div>
          <div class="col-span-1"><label>UF</label><input id="clientUF"/></div>
          <div class="col-span-8"><label>Endereço</label><input id="clientAddr"/></div>
          <div class="col-span-3"><label>Cidade</label><input id="clientCity"/></div>
          <div class="col-span-1"><label>Inscr. Est.</label><input id="clientIE"/></div>
        </div>
      </div>
    </section>

    <!-- CONTRATO / PAGAMENTO -->
    <section class="grid grid-cols-12">
      <div class="col-span-12 box border-l-0 border-r-0">
        <div class="title grid grid-cols-2"><span>CONTRATO</span><span class="text-right pr-2">PAGAMENTO</span></div>
        <div class="p-2 grid grid-cols-12 gap-2 kv text-[11px]">
          <div class="col-span-3"><label>Contrato</label><input id="contractNum"/></div>
          <div class="col-span-3"><label>PC</label><input id="pcNum"/></div>
          <div class="col-span-3"><label>Valor Mensal</label><input id="monthlyValue" type="number" step="0.01"/></div>
          <div class="col-span-3"><label>Vencimento</label><input id="dueDate" type="date"/></div>
          <div class="col-span-3"><label>Forma</label><input id="paymentTerms" value="DEPÓSITO BANCÁRIO"/></div>
          <div class="col-span-9"><label>Dados Bancários</label>
            <textarea id="bankData" rows="3">BANCO DO BRASIL
AGÊNCIA: 2372-8
CONTA CORRENTE: 20567-2
TRANSELIAN TRANSPORTES LTDA</textarea>
          </div>
        </div>
      </div>
    </section>

    <!-- OBSERVAÇÃO -->
    <section class="grid grid-cols-12">
      <div class="col-span-12 box border-l-0 border-r-0">
        <div class="title">OBSERVAÇÃO</div>
        <div class="p-2 kv text-[11px]">
          <textarea id="notes" rows="2">DESCONTO COMPRA DE 4 PNEUS (EDIM) SEGUNDA PARCELA : R$ 4.200,00</textarea>
        </div>
      </div>
    </section>

    <!-- DADOS DA LOCAÇÃO -->
    <section>
      <div class="title">DADOS DA LOCAÇÃO</div>
      <div class="no-print p-2 flex items-center gap-2">
        <button id="btnAddItem" class="px-2 py-1 rounded border text-sm">Adicionar item</button>
      </div>
      <div class="overflow-x-auto">
        <table class="invoice text-[11px]">
          <thead class="bg-gray-100">
            <tr>
              <th class="text-left p-2 w-24">Código</th>
              <th class="text-left p-2">Descrição / Quantidade</th>
              <th class="text-right p-2 w-32">Valor Unitário</th>
              <th class="text-right p-2 w-32">Valor Total</th>
              <th class="no-print w-20"></th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
          <tfoot>
            <tr>
              <td class="p-2" colspan="2"></td>
              <td class="p-2 text-right font-semibold">Valor Total da Fatura:</td>
              <td class="p-2 text-right font-bold text-[13px]" id="totalView">R$ 0,00</td>
              <td class="no-print"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </section>

    <!-- RECIBO -->
    <section class="grid grid-cols-12">
      <div class="col-span-12 box border-l-0 border-r-0">
        <div class="p-2 text-[10px]">
          RECEBI(EMOS) DE <span class="font-semibold">EMPRESA</span>, AS LOCAÇÕES CONSTANTES NESSA FATURA INDICADA AO LADO.
        </div>
      </div>
      <div class="col-span-6 box border-l-0 border-r-0">
        <div class="p-2 grid grid-cols-12 text-[11px] gap-2">
          <div class="col-span-6">DATA DO RECEBIMENTO</div>
          <div class="col-span-6">IDENTIFICAÇÃO E ASSINATURA DO RECEBEDOR</div>
        </div>
      </div>
      <div class="col-span-6 box border-l-0 border-r-0">
        <div class="p-2 text-right text-[12px]">N°: <span id="invNumberView2">299</span></div>
      </div>
    </section>
  </div>

  <!-- MODAL: Cliente (criar/editar) -->
  <div id="clientModal" class="no-print fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
    <div class="bg-white w-[680px] max-w-[95vw] rounded-xl shadow-xl p-4">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold">Cliente</h3>
        <button id="closeClientModal" class="px-2 py-1 rounded border">Fechar</button>
      </div>
      <div class="grid grid-cols-12 gap-3 kv text-[12px]">
        <div class="col-span-8"><label>Razão Social</label><input id="m_name" /></div>
        <div class="col-span-4"><label>CNPJ/CPF</label><input id="m_doc" /></div>
        <div class="col-span-8"><label>Endereço</label><input id="m_addr" /></div>
        <div class="col-span-3"><label>Cidade</label><input id="m_city" /></div>
        <div class="col-span-1"><label>UF</label><input id="m_uf" /></div>
        <div class="col-span-3"><label>CEP</label><input id="m_cep" /></div>
        <div class="col-span-3"><label>Inscr. Estadual</label><input id="m_ie" /></div>
        <div class="col-span-12"><label>Contato (opcional)</label><input id="m_contact" /></div>
      </div>
      <div class="flex items-center justify-between mt-4">
        <div class="text-sm text-slate-600">Os clientes ficam salvos no seu navegador (localStorage).</div>
        <div class="flex gap-2">
          <button id="btnDeleteClient" class="px-3 py-2 rounded border border-rose-300 text-rose-700">Excluir</button>
          <button id="btnSaveClient" class="px-3 py-2 rounded bg-indigo-600 text-white">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Gerenciar clientes -->
  <div id="manageModal" class="no-print fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
    <div class="bg-white w-[720px] max-w-[95vw] rounded-xl shadow-xl p-4">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold">Gerenciar clientes</h3>
        <button id="closeManageModal" class="px-2 py-1 rounded border">Fechar</button>
      </div>
      <div class="max-h-[60vh] overflow-y-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-50">
            <tr><th class="p-2 text-left">Razão Social</th><th class="p-2 text-left">Documento</th><th class="p-2">Ações</th></tr>
          </thead>
          <tbody id="clientsTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // Utilitários
    const $ = (s)=>document.querySelector(s);
    const el=(t,c)=>{const e=document.createElement(t); if(c) e.className=c; return e;};
    const fmt=(v)=> new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v||0);
    const store={set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)),get:(k,d=null)=>{try{return JSON.parse(localStorage.getItem(k))??d;}catch{return d;}},del:(k)=>localStorage.removeItem(k)};
    const uuid=()=> (window.crypto&&window.crypto.randomUUID)? window.crypto.randomUUID(): 'id-'+Date.now().toString(36)+'-'+Math.random().toString(36).slice(2,8);
    const on=(id,ev,fn)=>{const e=document.getElementById(id); if(e) e.addEventListener(ev,fn); else console.warn('Elemento não encontrado:',id)};

    // Estado
    const state={ selectedClientId: store.get('fatura_selected_client', null) };

    // Inputs principais
    const inputs={
      clientName: $('#clientName'), clientDoc: $('#clientDoc'), clientCEP: $('#clientCEP'), clientUF: $('#clientUF'), clientAddr: $('#clientAddr'), clientCity: $('#clientCity'), clientIE: $('#clientIE'),
      contractNum: $('#contractNum'), pcNum: $('#pcNum'), monthlyValue: $('#monthlyValue'), dueDate: $('#dueDate'),
      paymentTerms: $('#paymentTerms'), bankData: $('#bankData'), notes: $('#notes'),
    };

    // ===== Banco de dados (localStorage) =====
    let clients = store.get('fatura_clients', []);
    const clientSelect=$('#clientSelect');

    function renderClientSelect(){
      if(!clientSelect) return;
      clientSelect.innerHTML='';
      const opt0 = el('option'); opt0.value=""; opt0.textContent='— selecionar —'; clientSelect.appendChild(opt0);
      clients.forEach(c=>{ const o=el('option'); o.value=c.id; o.textContent=c.name; clientSelect.appendChild(o); });
      if(state.selectedClientId){ clientSelect.value=state.selectedClientId; }
    }
    function renderClientsTable(){
      const tb=$('#clientsTable'); if(!tb) return; tb.innerHTML='';
      clients.forEach(c=>{
        const tr=el('tr');
        tr.innerHTML=`<td class="p-2">${c.name}</td><td class="p-2">${c.doc||''}</td>`;
        const td=el('td','p-2 text-right');
        const b1=el('button','px-2 py-1 rounded border mr-2'); b1.textContent='Editar'; b1.onclick=()=>openClientModal(c.id);
        const b2=el('button','px-2 py-1 rounded border'); b2.textContent='Usar'; b2.onclick=()=>{fillClient(c); state.selectedClientId=c.id; store.set('fatura_selected_client', c.id); closeManageModal(); if(clientSelect) clientSelect.value=c.id;};
        td.append(b1,b2); tr.appendChild(td); tb.appendChild(tr);
      });
    }
    function saveClients(){ store.set('fatura_clients', clients); renderClientSelect(); renderClientsTable(); }

    function fillClient(c){
      if(!c) return;
      inputs.clientName.value=c.name||'';
      inputs.clientDoc.value=c.doc||'';
      inputs.clientCEP.value=c.cep||'';
      inputs.clientUF.value=c.uf||'';
      inputs.clientAddr.value=c.addr||'';
      inputs.clientCity.value=c.city||'';
      inputs.clientIE.value=c.ie||'';
      state.selectedClientId=c.id||null; store.set('fatura_selected_client', state.selectedClientId);
      persistAll();
    }

    // ===== Modais =====
    function openClientModal(id=null){
      const modal=$('#clientModal'); if(!modal) return; modal.classList.remove('hidden'); modal.classList.add('flex');
      const c = id ? clients.find(x=>x.id===id) : {id:null};
      modal.dataset.id = c?.id || '';
      $('#m_name').value=c?.name||''; $('#m_doc').value=c?.doc||''; $('#m_addr').value=c?.addr||''; $('#m_city').value=c?.city||''; $('#m_uf').value=c?.uf||''; $('#m_cep').value=c?.cep||''; $('#m_ie').value=c?.ie||''; $('#m_contact').value=c?.contact||'';
    }
    function closeClientModal(){ const m=$('#clientModal'); if(!m) return; m.classList.add('hidden'); m.classList.remove('flex'); }

    function openManageModal(){ const m=$('#manageModal'); if(!m) return; m.classList.remove('hidden'); m.classList.add('flex'); renderClientsTable(); }
    function closeManageModal(){ const m=$('#manageModal'); if(!m) return; m.classList.add('hidden'); m.classList.remove('flex'); }

    // Eventos topo (com proteção)
    on('btnAddClient','click',()=>openClientModal());
    on('btnManageClients','click',()=>openManageModal());
    on('closeClientModal','click',closeClientModal);
    on('closeManageModal','click',closeManageModal);
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape'){ closeClientModal(); closeManageModal(); }});

    // Salvar/Excluir cliente pelo modal
    on('btnSaveClient','click',()=>{
      const modal=$('#clientModal');
      const id = modal?.dataset.id || uuid();
      const c = {
        id,
        name: $('#m_name').value.trim(),
        doc: $('#m_doc').value.trim(),
        addr: $('#m_addr').value.trim(),
        city: $('#m_city').value.trim(), uf: $('#m_uf').value.trim(), cep: $('#m_cep').value.trim(), ie: $('#m_ie').value.trim(), contact: $('#m_contact').value.trim()
      };
      const idx = clients.findIndex(x=>x.id===id);
      if(idx>=0) clients[idx]=c; else clients.push(c);
      saveClients(); closeClientModal();
      fillClient(c); if(clientSelect) clientSelect.value=c.id;
    });

    on('btnDeleteClient','click',()=>{
      const modal=$('#clientModal'); const id=modal?.dataset.id; if(!id) return; if(!confirm('Excluir este cliente?')) return;
      clients = clients.filter(x=>x.id!==id); saveClients(); closeClientModal(); renderClientsTable();
      if(state.selectedClientId===id){ state.selectedClientId=null; store.del('fatura_selected_client'); if(clientSelect) clientSelect.value=''; }
    });

    if(clientSelect){
      clientSelect.addEventListener('change',()=>{ const c=clients.find(x=>x.id===clientSelect.value); if(c){ fillClient(c); } else { state.selectedClientId=null; store.del('fatura_selected_client'); }});
    }

    // Export/Import clientes
    on('btnExportClients','click',()=>{ const data=JSON.stringify(clients,null,2); const blob=new Blob([data],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='clientes.json'; a.click(); URL.revokeObjectURL(url); });
    const importClientsFile=$('#importClientsFile');
    on('btnImportClients','click',()=>importClientsFile?.click());
    if(importClientsFile){
      importClientsFile.addEventListener('change',(e)=>{ const f=e.target.files?.[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ clients=JSON.parse(r.result)||[]; saveClients(); alert('Clientes importados.'); }catch{ alert('Arquivo inválido.'); } }; r.readAsText(f); });
    }

    // ===== Itens =====
    const itemsBody=$('#itemsBody');
    function addItemRow(item={code:'', desc:'', qty:1, unit:0}){
      if(!itemsBody) return;
      const tr=el('tr');
      const tdCode=el('td','p-2 align-top');
      const tdDesc=el('td','p-2 align-top');
      const tdUnit=el('td','p-2 text-right align-top');
      const tdTot=el('td','p-2 text-right align-top');
      const tdDel=el('td','p-2 no-print');

      const iCode=el('input','w-full border rounded px-2 py-1 text-[12px]'); iCode.value=item.code||'';
      const iDesc=el('textarea','w-full border rounded px-2 py-1 text-[12px]'); iDesc.rows=3; iDesc.value=item.desc||'';
      const iUnit=el('input','w-full border rounded px-2 py-1 text-right text-[12px]'); iUnit.type='number'; iUnit.step='0.01'; iUnit.value=item.unit||0;
      const tot=el('div','text-[12px]');
      const btn=el('button','px-2 py-1 border rounded'); btn.textContent='Remover';

      tdCode.appendChild(iCode); tdDesc.appendChild(iDesc); tdUnit.appendChild(iUnit); tdTot.appendChild(tot); tdDel.appendChild(btn);
      tr.append(tdCode,tdDesc,tdUnit,tdTot,tdDel); itemsBody.appendChild(tr);

      function recalc(){ tot.textContent=fmt((parseFloat(iUnit.value)||0)*(parseFloat(1))); persistAll(); updateTotals(); }
      [iCode,iDesc].forEach(x=>x.addEventListener('input',()=>{persistAll();}));
      iUnit.addEventListener('input',recalc);
      btn.addEventListener('click',()=>{ tr.remove(); persistAll(); updateTotals(); });
      recalc();
    }

    function captureItems(){
      if(!itemsBody) return [];
      return [...itemsBody.querySelectorAll('tr')].map(r=>{
        const [code,desc,unit]=r.querySelectorAll('input, textarea');
        return {code:code?.value||'', desc:desc?.value||'', qty:1, unit:parseFloat(unit?.value)||0};
      });
    }
    function updateTotals(){
      const total=captureItems().reduce((a,it)=>a+(it.unit*(it.qty||1)),0);
      const tv=document.getElementById('totalView'); if(tv) tv.textContent=fmt(total);
    }

    on('btnAddItem','click',()=>addItemRow());

    // ===== Persistência da fatura =====
    function capture(){
      return {
        invNumber: document.getElementById('invNumberView')?.textContent||'',
        invDate: (document.getElementById('invDateView')?.textContent||'').split('/').reverse().join('-'),
        clientName: inputs.clientName.value, clientDoc: inputs.clientDoc.value, clientCEP: inputs.clientCEP.value, clientUF: inputs.clientUF.value, clientAddr: inputs.clientAddr.value, clientCity: inputs.clientCity.value, clientIE: inputs.clientIE.value,
        contractNum: inputs.contractNum.value, pcNum: inputs.pcNum.value, monthlyValue: parseFloat(inputs.monthlyValue.value)||0, dueDate: inputs.dueDate.value,
        paymentTerms: inputs.paymentTerms.value, bankData: inputs.bankData.value, notes: inputs.notes.value,
        items: captureItems()
      };
    }
    function apply(d){
      const n1=document.getElementById('invNumberView'); const n2=document.getElementById('invNumberView2'); const dv=document.getElementById('invDateView');
      if(n1) n1.textContent = d.invNumber || '000';
      if(n2) n2.textContent = d.invNumber || '000';
      if(dv) dv.textContent = (d.invDate||'').split('-').reverse().join('/') || '';
      for(const k of Object.keys(inputs)){ if(inputs[k]) inputs[k].value = d[k] ?? inputs[k].value; }
      if(itemsBody){ itemsBody.innerHTML=''; (d.items||[]).forEach(addItemRow); updateTotals(); }
    }
    function persistAll(){ store.set('fatura_current', capture()); }

    // refletir inputs cabeçalho
    const invNumber=document.getElementById('invNumber');
    const invDate=document.getElementById('invDate');
    if(invNumber){ invNumber.addEventListener('input',()=>{ const v=invNumber.value||'000'; const n1=document.getElementById('invNumberView'); const n2=document.getElementById('invNumberView2'); if(n1) n1.textContent=v; if(n2) n2.textContent=v; persistAll(); }); }
    if(invDate){ invDate.addEventListener('change',()=>{ const d=invDate.value; const dv=document.getElementById('invDateView'); if(dv) dv.textContent = d? d.split('-').reverse().join('/') : '__/__/____'; persistAll(); }); }

    // Rascunho + impressão
    on('btnSaveCurrent','click',()=>{ persistAll(); alert('Rascunho salvo.'); });
    on('btnLoadCurrent','click',()=>{ const d=store.get('fatura_current'); if(d) apply(d); else alert('Nenhum rascunho.'); });
    on('btnPrint','click',()=>window.print());

    // Init
    renderClientSelect();
    const d=store.get('fatura_current');
    if(d){ apply(d); }
    else{
      apply({
        invNumber:'299', invDate:'2025-08-30',
        clientName:'PRUMO ENGENHARIA EIRELI', clientDoc:'20.651.311/0001-28', clientCEP:'35570009', clientUF:'MG', clientAddr:'PÁTIO DA ESTAÇÃO FERROVIÁRIA, 15 – CENTRO', clientCity:'FORMIGA', clientIE:'2.612.401.260.076',
        contractNum:'3531/2022', pcNum:'447377', monthlyValue:18000, dueDate:'2025-10-07',
        paymentTerms:'DEPÓSITO BANCÁRIO', bankData:`BANCO DO BRASIL\nAGÊNCIA: 2372-8\nCONTA CORRENTE: 20567-2\nTRANSELIAN TRANSPORTES LTDA`,
        notes:'DESCONTO COMPRA DE 4 PNEUS (EDIM) SEGUNDA PARCELA : R$ 4.200,00',
        items:[{code:'',desc:`LOCAÇÃO DE CAMINHÃO MUNCK, SEM MOTORISTA.\nPLACA DO CAMINHÃO : RUB1A61\nPERÍODO: 26/07/2025 a 25/08/2025\nVENCIMENTO: 07/10/2025`, qty:1, unit:13800.00}]
      });
    }
    if(state.selectedClientId){ const c=clients.find(x=>x.id===state.selectedClientId); if(c){ fillClient(c); if(clientSelect) clientSelect.value=c.id; }}
  })();
      (function(){
    const $ = (s)=>document.querySelector(s);

    function getFileName(){
      const client = $('#clientName')?.value?.trim() || 'Cliente';
      const num = $('#invNumberView')?.textContent?.trim() || '000';
      const data = $('#invDateView')?.textContent?.trim() || '';
      let mes = '';
      if(data){
        const partes=data.split('/');
        if(partes.length>=2){
          const mesNum = parseInt(partes[1],10);
          const meses=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
          mes = meses[mesNum-1] || '';
        }
      }
      return `${client} - Nota ${num} - ${mes}.pdf`;
    }

    document.getElementById('btnExportPDF').addEventListener('click',()=>{
      const fileName=getFileName();
      console.log("Sugestão de nome do arquivo:",fileName);
      window.print();
    });
  })();
  </script>
</body>
</html>


